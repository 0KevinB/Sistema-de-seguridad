const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BOzkANz2.js","assets/index-BiuXVYxO.css"])))=>i.map(i=>d[i]);
import{u as C,r as f,j as D,h as x,c as n,a,b as m,w as h,t as p,d as U,v as k,F as w,k as E,_ as j,o as u}from"./index-BOzkANz2.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const I={class:"auth-container"},N={class:"auth-card"},R={key:0,class:"metodos-container"},$={key:1,class:"verificacion-container"},q={class:"info-box"},T={class:"form-group"},H=["disabled"],L={key:0,class:"error-message"},O=["disabled"],z=["onUpdate:modelValue","disabled"],G={key:0,class:"error-message"},J=["disabled"],K={class:"form-group"},Q=["disabled"],W={key:0,class:"error-message"},X=["disabled"],Y={__name:"MFA",setup(Z){const b=x(),d=C(),c=f(null),o=f(!1),t=f(""),r=f({codigo:"",identificadorUSB:"",idMFA:null}),y=f([]),g=f([]);D(()=>{d.mfaData||b.push("/login")});const _=async i=>{var e,s;if(c.value=i,t.value="",i==="email"||i==="sms")try{o.value=!0;const l=await d.solicitarCodigoMFA(i,d.mfaData.idUsuario);l.success&&l.idMFA&&(r.value.idMFA=l.idMFA)}catch{t.value="Error al enviar cÃ³digo"}finally{o.value=!1}else if(i==="preguntas")try{o.value=!0;const v=await(await j(async()=>{const{default:S}=await import("./index-BOzkANz2.js").then(B=>B.x);return{default:S}},__vite__mapDeps([0,1]))).default.obtenerPreguntasSeguridad(d.mfaData.idUsuario);v.success&&v.preguntas?(y.value=v.preguntas,g.value=new Array(v.preguntas.length).fill("")):(t.value="No hay preguntas de seguridad configuradas",c.value=null)}catch(l){t.value=((s=(e=l.response)==null?void 0:e.data)==null?void 0:s.mensaje)||"Error al cargar preguntas",c.value=null}finally{o.value=!1}},M=()=>{c.value=null,r.value.codigo="",r.value.identificadorUSB="",r.value.idMFA=null,g.value=[],y.value=[],t.value=""},A=async()=>{var i,e;if(o.value=!0,t.value="",!r.value.idMFA){t.value="Error: No se ha generado el cÃ³digo MFA",o.value=!1;return}try{const s=await d.validarMFA(r.value.idMFA,r.value.codigo,d.mfaData.idUsuario);s.success?b.push("/dashboard"):t.value=s.mensaje||"CÃ³digo invÃ¡lido"}catch(s){t.value=((e=(i=s.response)==null?void 0:i.data)==null?void 0:e.mensaje)||"Error al validar cÃ³digo"}finally{o.value=!1}},F=async()=>{var i,e;o.value=!0,t.value="";try{const s=y.value.map((v,S)=>({idPregunta:v.idPregunta,respuesta:g.value[S]})),l=await d.validarPreguntas(d.mfaData.idUsuario,s);l.success?b.push("/dashboard"):t.value=l.mensaje||"Respuestas incorrectas"}catch(s){t.value=((e=(i=s.response)==null?void 0:i.data)==null?void 0:e.mensaje)||"Error al validar respuestas"}finally{o.value=!1}},V=async()=>{var i,e;o.value=!0,t.value="";try{const s=await d.validarUSB(d.mfaData.idUsuario,r.value.identificadorUSB);s.success?b.push("/dashboard"):t.value=s.mensaje||"Dispositivo no reconocido"}catch(s){t.value=((e=(i=s.response)==null?void 0:i.data)==null?void 0:e.mensaje)||"Error al validar dispositivo"}finally{o.value=!1}};return(i,e)=>(u(),n("div",I,[a("div",N,[e[12]||(e[12]=a("h1",{class:"auth-title"},"VerificaciÃ³n de Segundo Factor",-1)),e[13]||(e[13]=a("p",{class:"auth-subtitle"},"Selecciona un mÃ©todo de verificaciÃ³n",-1)),c.value?(u(),n("div",$,[a("button",{onClick:M,class:"btn-back"},"â† Volver a mÃ©todos"),c.value==="email"||c.value==="sms"?(u(),n("form",{key:0,onSubmit:h(A,["prevent"]),class:"auth-form"},[a("div",q," Se ha enviado un cÃ³digo de verificaciÃ³n a tu "+p(c.value==="email"?"correo":"telÃ©fono"),1),a("div",T,[e[10]||(e[10]=a("label",{for:"codigo"},"CÃ³digo de VerificaciÃ³n",-1)),U(a("input",{type:"text",id:"codigo","onUpdate:modelValue":e[4]||(e[4]=s=>r.value.codigo=s),required:"",disabled:o.value,placeholder:"123456",maxlength:"6"},null,8,H),[[k,r.value.codigo]])]),t.value?(u(),n("div",L,p(t.value),1)):m("",!0),a("button",{type:"submit",class:"btn-primary",disabled:o.value},p(o.value?"Verificando...":"Verificar CÃ³digo"),9,O)],32)):m("",!0),c.value==="preguntas"?(u(),n("form",{key:1,onSubmit:h(F,["prevent"]),class:"auth-form"},[(u(!0),n(w,null,E(y.value,(s,l)=>(u(),n("div",{class:"form-group",key:l},[a("label",null,p(s.pregunta),1),U(a("input",{type:"text","onUpdate:modelValue":v=>g.value[l]=v,required:"",disabled:o.value,placeholder:"Tu respuesta"},null,8,z),[[k,g.value[l]]])]))),128)),t.value?(u(),n("div",G,p(t.value),1)):m("",!0),a("button",{type:"submit",class:"btn-primary",disabled:o.value},p(o.value?"Verificando...":"Verificar Respuestas"),9,J)],32)):m("",!0),c.value==="usb"?(u(),n("form",{key:2,onSubmit:h(V,["prevent"]),class:"auth-form"},[a("div",K,[e[11]||(e[11]=a("label",{for:"identificador"},"Identificador del Dispositivo USB",-1)),U(a("input",{type:"text",id:"identificador","onUpdate:modelValue":e[5]||(e[5]=s=>r.value.identificadorUSB=s),required:"",disabled:o.value,placeholder:"Identificador del USB"},null,8,Q),[[k,r.value.identificadorUSB]])]),t.value?(u(),n("div",W,p(t.value),1)):m("",!0),a("button",{type:"submit",class:"btn-primary",disabled:o.value},p(o.value?"Verificando...":"Verificar Dispositivo"),9,X)],32)):m("",!0)])):(u(),n("div",R,[a("button",{onClick:e[0]||(e[0]=s=>_("email")),class:"metodo-btn"},[...e[6]||(e[6]=[a("span",{class:"metodo-icon"},"ðŸ“§",-1),a("span",{class:"metodo-text"},"CÃ³digo por Email",-1)])]),a("button",{onClick:e[1]||(e[1]=s=>_("sms")),class:"metodo-btn"},[...e[7]||(e[7]=[a("span",{class:"metodo-icon"},"ðŸ“±",-1),a("span",{class:"metodo-text"},"CÃ³digo por SMS",-1)])]),a("button",{onClick:e[2]||(e[2]=s=>_("preguntas")),class:"metodo-btn"},[...e[8]||(e[8]=[a("span",{class:"metodo-icon"},"â“",-1),a("span",{class:"metodo-text"},"Preguntas de Seguridad",-1)])]),a("button",{onClick:e[3]||(e[3]=s=>_("usb")),class:"metodo-btn"},[...e[9]||(e[9]=[a("span",{class:"metodo-icon"},"ðŸ”‘",-1),a("span",{class:"metodo-text"},"Dispositivo USB",-1)])])]))])]))}},se=P(Y,[["__scopeId","data-v-9546d4e5"]]);export{se as default};
