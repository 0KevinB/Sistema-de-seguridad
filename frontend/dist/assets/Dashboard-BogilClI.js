import{u as y,r as m,j as $,n as A,c as C,b as D,o as k,a as s,t as a,h as w,e as S,p as l,f as h,g as I,i as M}from"./index-BOzkANz2.js";import{u as g}from"./userService-DiuQdIr4.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";const V={key:0,class:"session-alert-overlay"},B={class:"session-alert"},L={class:"alert-detail"},P={class:"alert-actions"},R=["disabled"],T=["disabled"],j={__name:"SessionMonitor",setup(U){const b=w(),t=y(),c=m(!1),i=m(!1),o=m(""),r=m(null);let d=null;const u=async()=>{var n;try{const e=await g.obtenerSesiones();if(e.success){const v=e.sesiones.filter(f=>f.activo===1),E=(n=t.currentUser)==null?void 0:n.idSession;if(v.length>1){const f=v.find(N=>N.idSession!==E);f&&!c.value&&(c.value=!0,r.value=f.idSession,o.value=new Date(f.fecha).toLocaleString("es-ES"))}}}catch(e){console.error("Error al verificar sesiones:",e)}},_=async()=>{i.value=!0;try{r.value&&(await g.cerrarSesionRemota(r.value),c.value=!1,r.value=null)}catch(n){console.error("Error al cerrar sesiÃ³n:",n),alert("Error al cerrar la otra sesiÃ³n")}finally{i.value=!1}},p=async()=>{i.value=!0;try{await t.logout(),b.push("/login")}catch(n){console.error("Error al cerrar sesiÃ³n:",n)}finally{i.value=!1}};return $(()=>{d=setInterval(u,1e4),u()}),A(()=>{d&&clearInterval(d)}),(n,e)=>c.value?(k(),C("div",V,[s("div",B,[e[0]||(e[0]=s("div",{class:"alert-icon"},"âš ï¸",-1)),e[1]||(e[1]=s("h2",null,"Nueva SesiÃ³n Detectada",-1)),e[2]||(e[2]=s("p",null,"Se ha iniciado sesiÃ³n desde otro dispositivo o navegador.",-1)),s("p",L,a(o.value),1),s("div",P,[s("button",{onClick:_,class:"btn-primary",disabled:i.value},a(i.value?"Cerrando...":"Cerrar otra sesiÃ³n y continuar aquÃ­"),9,R),s("button",{onClick:p,class:"btn-secondary",disabled:i.value}," Cerrar esta sesiÃ³n ",8,T)])])])):D("",!0)}},q=x(j,[["__scopeId","data-v-c8ce52c5"]]),F={class:"dashboard"},H={class:"navbar"},O={class:"nav-content"},z={class:"nav-actions"},G={class:"user-name"},J={class:"dashboard-content"},K={class:"welcome-card"},Q={class:"welcome-title"},W={class:"info-grid"},X={class:"info-card"},Y={class:"info-content"},Z={class:"info-card"},ss={class:"info-content"},os={class:"info-card"},es={class:"info-content"},ts={class:"actions-card"},ns={class:"actions-grid"},as={__name:"Dashboard",setup(U){const b=w(),t=y(),c=async()=>{await t.logout(),b.push("/login")};return(i,o)=>{var d,u,_,p,n,e,v;const r=I("router-link");return k(),C("div",F,[S(q),s("nav",H,[s("div",O,[o[1]||(o[1]=s("h2",{class:"nav-title"},"Sistema de Seguridad",-1)),s("div",z,[s("span",G,a((d=l(t).currentUser)==null?void 0:d.nombres)+" "+a((u=l(t).currentUser)==null?void 0:u.apellidos),1),S(r,{to:"/perfil",class:"nav-link"},{default:h(()=>[...o[0]||(o[0]=[M("Mi Perfil",-1)])]),_:1}),s("button",{onClick:c,class:"btn-logout"},"Cerrar SesiÃ³n")])])]),s("div",J,[s("div",K,[s("h1",Q,"Bienvenido, "+a((_=l(t).currentUser)==null?void 0:_.nombres)+" "+a((p=l(t).currentUser)==null?void 0:p.apellidos),1),o[2]||(o[2]=s("p",{class:"welcome-text"},"Has iniciado sesiÃ³n exitosamente en el sistema de seguridad multi-factor.",-1))]),s("div",W,[s("div",X,[o[4]||(o[4]=s("div",{class:"info-icon"},"ğŸ‘¤",-1)),s("div",Y,[o[3]||(o[3]=s("h3",null,"Usuario",-1)),s("p",null,a((n=l(t).currentUser)==null?void 0:n.usuario),1)])]),s("div",Z,[o[6]||(o[6]=s("div",{class:"info-icon"},"ğŸ“§",-1)),s("div",ss,[o[5]||(o[5]=s("h3",null,"Email",-1)),s("p",null,a((e=l(t).currentUser)==null?void 0:e.email),1)])]),s("div",os,[o[8]||(o[8]=s("div",{class:"info-icon"},"ğŸ“±",-1)),s("div",es,[o[7]||(o[7]=s("h3",null,"TelÃ©fono",-1)),s("p",null,a(((v=l(t).currentUser)==null?void 0:v.telefono)||"No registrado"),1)])]),o[9]||(o[9]=s("div",{class:"info-card"},[s("div",{class:"info-icon"},"âœ…"),s("div",{class:"info-content"},[s("h3",null,"Estado"),s("p",null,"SesiÃ³n Activa")])],-1))]),s("div",ts,[o[12]||(o[12]=s("h2",null,"Acciones Disponibles",-1)),s("div",ns,[S(r,{to:"/perfil",class:"action-btn"},{default:h(()=>[...o[10]||(o[10]=[s("span",{class:"action-icon"},"ğŸ‘¤",-1),s("span",{class:"action-text"},"Ver Mi Perfil",-1)])]),_:1}),S(r,{to:"/configurar-mfa",class:"action-btn"},{default:h(()=>[...o[11]||(o[11]=[s("span",{class:"action-icon"},"ğŸ”",-1),s("span",{class:"action-text"},"Configurar MFA",-1)])]),_:1})])])])])}}},cs=x(as,[["__scopeId","data-v-bf956c1e"]]);export{cs as default};
