import{u as R,r as u,j as G,c,a as s,e as x,f as D,g as I,t as d,p as h,w as A,b as k,d as _,v as g,q as U,F as H,k as $,h as J,o as v,i as q}from"./index-BOzkANz2.js";import{u as C}from"./userService-DiuQdIr4.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"dashboard"},Q={class:"navbar"},W={class:"nav-content"},X={class:"dashboard-content"},Y={class:"profile-card"},Z={class:"profile-info"},ee={class:"info-row"},se={class:"info-value"},ae={class:"info-row"},oe={class:"info-value"},te={class:"info-row"},le={class:"info-value"},re={class:"info-row"},ne={class:"info-value"},ie={class:"actions"},de={class:"edit-section"},ue={class:"form-group"},ce=["disabled"],ve={class:"form-group"},me=["disabled"],fe={class:"form-group"},pe=["disabled"],be=["disabled"],_e={class:"password-section"},ge={class:"form-group"},he=["disabled"],ye={class:"form-group"},Ce=["disabled"],we={class:"form-group"},Se=["disabled"],ke=["disabled"],Ue={class:"sessions-section"},Ee={key:0,class:"loading"},Ve={key:1,class:"empty"},Ne={key:2,class:"sessions-list"},Te={class:"session-info"},je={class:"session-status"},xe={class:"session-date"},De=["onClick"],Ae=["disabled"],qe={__name:"Perfil",setup(ze){const z=J(),n=R(),p=u(!1),y=u(!1),b=u(!1),r=u(""),m=u(""),w=u([]),E=u(null),i=u({actual:"",nueva:"",confirmar:""}),l=u({nombres:"",apellidos:"",telefono:""}),M=async()=>{await n.logout(),z.push("/login")},F=async()=>{var a,e;if(r.value="",i.value.nueva!==i.value.confirmar){r.value="âŒ Las contraseÃ±as no coinciden";return}if(i.value.nueva.length<8){r.value="âŒ La contraseÃ±a debe tener al menos 8 caracteres";return}p.value=!0;try{const t=await C.cambiarContrasena(i.value.actual,i.value.nueva);t.success?(r.value="âœ… ContraseÃ±a cambiada correctamente",i.value={actual:"",nueva:"",confirmar:""},setTimeout(()=>{r.value=""},5e3)):r.value="âŒ "+t.mensaje}catch(t){r.value="âŒ "+(((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.mensaje)||"Error al cambiar contraseÃ±a")}finally{p.value=!1}},S=async()=>{y.value=!0;try{const a=await C.obtenerSesiones();a.success&&(w.value=a.sesiones,E.value=a.sessionActual)}catch(a){console.error("Error al cargar sesiones:",a),r.value="âŒ Error al cargar sesiones"}finally{y.value=!1}},L=async a=>{var e,t;if(confirm("Â¿Cerrar esta sesiÃ³n? El otro dispositivo serÃ¡ desconectado."))try{const f=await C.cerrarSesionRemota(a);f.success?(r.value="âœ… SesiÃ³n cerrada correctamente",await S()):r.value="âŒ "+f.mensaje}catch(f){r.value="âŒ Error al cerrar sesiÃ³n: "+(((t=(e=f.response)==null?void 0:e.data)==null?void 0:t.mensaje)||f.message)}},P=async()=>{var a,e;m.value="",b.value=!0;try{const t=await C.actualizarDatos({nombres:l.value.nombres,apellidos:l.value.apellidos,telefono:l.value.telefono});t.success?(m.value="âœ… Datos actualizados correctamente",n.currentUser.nombres=l.value.nombres,n.currentUser.apellidos=l.value.apellidos,n.currentUser.telefono=l.value.telefono,setTimeout(()=>{m.value=""},5e3)):m.value="âŒ "+t.mensaje}catch(t){m.value="âŒ "+(((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.mensaje)||"Error al actualizar datos")}finally{b.value=!1}},B=a=>new Date(a).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return G(()=>{var a,e,t;l.value.nombres=((a=n.currentUser)==null?void 0:a.nombres)||"",l.value.apellidos=((e=n.currentUser)==null?void 0:e.apellidos)||"",l.value.telefono=((t=n.currentUser)==null?void 0:t.telefono)||"",S()}),(a,e)=>{var f,V,N,T,j;const t=I("router-link");return v(),c("div",O,[s("nav",Q,[s("div",W,[x(t,{to:"/dashboard",class:"back-link"},{default:D(()=>[...e[6]||(e[6]=[q("â† Volver al Dashboard",-1)])]),_:1}),s("button",{onClick:M,class:"btn-logout"},"Cerrar SesiÃ³n")])]),s("div",X,[s("div",Y,[e[21]||(e[21]=s("h1",{class:"profile-title"},"Mi Perfil",-1)),s("div",Z,[s("div",ee,[e[7]||(e[7]=s("span",{class:"info-label"},"Usuario:",-1)),s("span",se,d((f=h(n).currentUser)==null?void 0:f.usuario),1)]),s("div",ae,[e[8]||(e[8]=s("span",{class:"info-label"},"Nombre:",-1)),s("span",oe,d((V=h(n).currentUser)==null?void 0:V.nombres)+" "+d((N=h(n).currentUser)==null?void 0:N.apellidos),1)]),s("div",te,[e[9]||(e[9]=s("span",{class:"info-label"},"Email:",-1)),s("span",le,d((T=h(n).currentUser)==null?void 0:T.email),1)]),s("div",re,[e[10]||(e[10]=s("span",{class:"info-label"},"TelÃ©fono:",-1)),s("span",ne,d(((j=h(n).currentUser)==null?void 0:j.telefono)||"No registrado"),1)])]),s("div",ie,[x(t,{to:"/configurar-mfa",class:"btn-action"},{default:D(()=>[...e[11]||(e[11]=[q("Configurar MFA",-1)])]),_:1})]),s("div",de,[e[15]||(e[15]=s("h2",{class:"section-title"},"Editar Datos Personales",-1)),s("form",{onSubmit:A(P,["prevent"]),class:"edit-form"},[s("div",ue,[e[12]||(e[12]=s("label",{for:"nombres"},"Nombres",-1)),_(s("input",{type:"text",id:"nombres","onUpdate:modelValue":e[0]||(e[0]=o=>l.value.nombres=o),required:"",disabled:b.value,placeholder:"Tus nombres"},null,8,ce),[[g,l.value.nombres]])]),s("div",ve,[e[13]||(e[13]=s("label",{for:"apellidos"},"Apellidos",-1)),_(s("input",{type:"text",id:"apellidos","onUpdate:modelValue":e[1]||(e[1]=o=>l.value.apellidos=o),required:"",disabled:b.value,placeholder:"Tus apellidos"},null,8,me),[[g,l.value.apellidos]])]),s("div",fe,[e[14]||(e[14]=s("label",{for:"telefono"},"TelÃ©fono",-1)),_(s("input",{type:"text",id:"telefono","onUpdate:modelValue":e[2]||(e[2]=o=>l.value.telefono=o),disabled:b.value,placeholder:"Tu nÃºmero de telÃ©fono"},null,8,pe),[[g,l.value.telefono]])]),m.value?(v(),c("div",{key:0,class:U(["alert",m.value.includes("âœ…")?"alert-success":"alert-error"])},d(m.value),3)):k("",!0),s("button",{type:"submit",class:"btn-action",disabled:b.value},d(b.value?"Guardando...":"Guardar Cambios"),9,be)],32)]),s("div",_e,[e[19]||(e[19]=s("h2",{class:"section-title"},"Cambiar ContraseÃ±a",-1)),s("form",{onSubmit:A(F,["prevent"]),class:"password-form"},[s("div",ge,[e[16]||(e[16]=s("label",{for:"actual"},"ContraseÃ±a Actual",-1)),_(s("input",{type:"password",id:"actual","onUpdate:modelValue":e[3]||(e[3]=o=>i.value.actual=o),required:"",disabled:p.value,placeholder:"Tu contraseÃ±a actual"},null,8,he),[[g,i.value.actual]])]),s("div",ye,[e[17]||(e[17]=s("label",{for:"nueva"},"Nueva ContraseÃ±a",-1)),_(s("input",{type:"password",id:"nueva","onUpdate:modelValue":e[4]||(e[4]=o=>i.value.nueva=o),required:"",disabled:p.value,placeholder:"MÃ­nimo 8 caracteres",minlength:"8"},null,8,Ce),[[g,i.value.nueva]])]),s("div",we,[e[18]||(e[18]=s("label",{for:"confirmar"},"Confirmar Nueva ContraseÃ±a",-1)),_(s("input",{type:"password",id:"confirmar","onUpdate:modelValue":e[5]||(e[5]=o=>i.value.confirmar=o),required:"",disabled:p.value,placeholder:"Repite la nueva contraseÃ±a"},null,8,Se),[[g,i.value.confirmar]])]),r.value?(v(),c("div",{key:0,class:U(["alert",r.value.includes("âœ…")?"alert-success":"alert-error"])},d(r.value),3)):k("",!0),s("button",{type:"submit",class:"btn-action",disabled:p.value},d(p.value?"Cambiando...":"Cambiar ContraseÃ±a"),9,ke)],32)]),s("div",Ue,[e[20]||(e[20]=s("h2",{class:"section-title"},"Historial de Sesiones",-1)),y.value?(v(),c("div",Ee,"Cargando sesiones...")):w.value.length===0?(v(),c("div",Ve," No hay sesiones registradas ")):(v(),c("div",Ne,[(v(!0),c(H,null,$(w.value,o=>(v(),c("div",{key:o.idSession,class:U(["session-item",{active:o.activo}])},[s("div",Te,[s("span",je,d(o.activo?"ğŸŸ¢ Activa":"âšª Cerrada"),1),s("span",xe,d(B(o.fecha)),1)]),o.activo&&o.idSession!==E.value?(v(),c("button",{key:0,onClick:Me=>L(o.idSession),class:"btn-close-session"}," Cerrar SesiÃ³n ",8,De)):k("",!0)],2))),128))])),s("button",{onClick:S,class:"btn-refresh",disabled:y.value}," ğŸ”„ Actualizar ",8,Ae)])])])])}}},Be=K(qe,[["__scopeId","data-v-c8da515e"]]);export{Be as default};
